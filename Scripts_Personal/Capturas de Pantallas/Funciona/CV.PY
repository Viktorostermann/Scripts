import cv2
import os
import datetime

# Directorio para guardar im√°genes y videos
DIRECTORIO = "C:/Users/vikto/Python_VsCode/Capturas"
os.makedirs(DIRECTORIO, exist_ok=True)

# Configurar c√°mara
cap = cv2.VideoCapture(0, cv2.CAP_DSHOW)

# Configurar grabaci√≥n de video
grabando = False
video_writer = None

if not cap.isOpened():
    print("Error: No se pudo acceder a la c√°mara.")
    exit()

while True:
    ret, frame = cap.read()
    if not ret or frame is None:
        print("Error: No se pudo capturar el fotograma.")
        break

    cv2.imshow("Vista de c√°mara", frame)

    key = cv2.waitKey(1) & 0xFF
    
    # **Cerrar ventana**
    if key == ord('q'):
        break

    # **Capturar imagen**
    elif key == ord('c'):
        nombre_img = os.path.join(DIRECTORIO, f"captura_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.png")
        cv2.imwrite(nombre_img, frame)
        print(f"üì∏ Imagen guardada en {nombre_img}")

    # **Iniciar/Detener grabaci√≥n de video**
    elif key == ord('v'):
        if not grabando:
            nombre_video = os.path.join(DIRECTORIO, f"video_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.avi")
            video_writer = cv2.VideoWriter(nombre_video, cv2.VideoWriter_fourcc(*"XVID"), 20, (frame.shape[1], frame.shape[0]))
            grabando = True
            print(f"üé• Grabaci√≥n iniciada: {nombre_video}")
        else:
            grabando = False
            video_writer.release()
            print("‚èπ Grabaci√≥n detenida.")

    # **Guardar fotogramas si est√° grabando**
    if grabando:
        video_writer.write(frame)

cap.release()
cv2.destroyAllWindows()
